# 学习收获保存问题修复说明

## 问题现象
当学生在填写课程的收获与成果时，发现学习收获无法保存到数据库表 `student_learning_achievements` 中，但技术标签和学习成果可以正常保存到对应的表中。

## 问题原因分析

经过仔细排查，发现问题出现在 `src/api/studentLearning.js` 文件中的 `/sync-learning-achievement` 路由处理逻辑中：

1. 在创建新的学习收获记录时，使用了错误的字段名：
   - 错误使用了 `achievement_title` 和 `achievement_content` 字段
   - 但数据库表 `student_learning_achievements` 中实际的字段名为 `title` 和 `content`

2. 在更新已有学习收获记录时，同样使用了错误的字段名：
   - 错误使用了 `achievement_content` 字段
   - 应该使用 `content` 字段

3. 插入新记录时缺少必要的字段：
   - 缺少 `achieved_at` 字段（NOT NULL约束）
   - 缺少 `impact_level` 字段（有默认值，但最好明确指定）

## 解决方案

修改 `src/api/studentLearning.js` 文件中的 `/sync-learning-achievement` 路由处理逻辑：

### 1. 修复创建新记录的逻辑
```javascript
// 修复前
const { data: newData, error: insertError } = await supabase
  .from('student_learning_achievements')
  .insert({
    student_profile_id,
    achievement_title: `${course_name} - 学习收获`,
    achievement_content: content,
    achievement_type: 'study_reflection',
    related_course: course_name,
    status: 'active',
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  })

// 修复后
const { data: newData, error: insertError } = await supabase
  .from('student_learning_achievements')
  .insert({
    student_profile_id,
    title: `${course_name} - 学习收获`,
    content: content,
    achievement_type: 'study_reflection',
    related_course: course_name,
    status: 'active',
    achieved_at: new Date().toISOString().split('T')[0],
    impact_level: 'medium',
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  })
```

### 2. 修复更新记录的逻辑
```javascript
// 修复前
const { data: updatedData, error: updateError } = await supabase
  .from('student_learning_achievements')
  .update({
    achievement_content: content,
    updated_at: new Date().toISOString()
  })

// 修复后
const { data: updatedData, error: updateError } = await supabase
  .from('student_learning_achievements')
  .update({
    content: content,
    updated_at: new Date().toISOString()
  })
```

## 验证方法

1. 重启API服务器
2. 使用学生账号登录系统
3. 进入课程填写页面
4. 填写学习收获内容并提交
5. 检查数据库表 `student_learning_achievements` 中是否已成功插入记录

## 其他说明

技术标签和学习成果能够正常保存是因为它们对应的API路由（`/add-technical-tag` 和 `/add-learning-outcome`）使用了正确的字段名，而同步学习收获的路由（`/sync-learning-achievement`）存在字段名不匹配的问题。

本次修复仅针对学习收获保存的问题，不影响系统的其他功能。