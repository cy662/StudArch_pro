<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javaæ ‡ç­¾æœç´¢æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .success { background: #e8f5e8; color: #2e7d2e; }
        .error { background: #ffebee; color: #c62828; }
        .info { background: #e3f2fd; color: #1976d2; }
        .warning { background: #fff3e0; color: #f57c00; }
        .loading { background: #f5f5f5; color: #666; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 14px;
        }
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }
        .btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.primary {
            background: #28a745;
        }
        .btn.primary:hover {
            background: #218838;
        }
        .btn.warning {
            background: #ffc107;
            color: #212529;
        }
        .btn.warning:hover {
            background: #e0a800;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .highlight {
            background: yellow;
            font-weight: bold;
        }
        .step {
            margin-bottom: 25px;
        }
        .step h3 {
            margin-bottom: 10px;
            color: #333;
        }
        .step-content {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Javaæ ‡ç­¾æœç´¢ä¸“é¡¹æµ‹è¯•</h1>
    
    <!-- åˆå§‹åŒ–çŠ¶æ€ -->
    <div class="container">
        <div id="initStatus" class="status loading">æ­£åœ¨åˆå§‹åŒ–...</div>
        <div id="overallStatus"></div>
    </div>

    <!-- æ­¥éª¤1: æ£€æŸ¥å­¦ç”Ÿæ•°æ® -->
    <div class="container step">
        <h3>æ­¥éª¤1: æ£€æŸ¥å­¦ç”Ÿ2023015701æ•°æ®</h3>
        <div class="step-content">
            <button class="btn" onclick="checkStudent2023015701()">æ£€æŸ¥å­¦ç”Ÿæ•°æ®</button>
            <button class="btn warning" onclick="createJavaTagForStudent()">åˆ›å»ºJavaæ ‡ç­¾</button>
            <div id="studentStatus"></div>
        </div>
    </div>

    <!-- æ­¥éª¤2: æ£€æŸ¥æ•™å¸ˆæ•°æ® -->
    <div class="container step">
        <h3>æ­¥éª¤2: æ£€æŸ¥æ•™å¸ˆæ•°æ®</h3>
        <div class="step-content">
            <button class="btn" onclick="checkTeachers()">æ£€æŸ¥æ•™å¸ˆæ•°æ®</button>
            <button class="btn warning" onclick="createTeacherStudentRelation()">åˆ›å»ºå¸ˆç”Ÿå…³è”</button>
            <div id="teacherStatus"></div>
        </div>
    </div>

    <!-- æ­¥éª¤3: Javaæ ‡ç­¾æœç´¢æµ‹è¯• -->
    <div class="container step">
        <h3>æ­¥éª¤3: Javaæ ‡ç­¾æœç´¢æµ‹è¯•</h3>
        <div class="step-content">
            <button class="btn primary" onclick="testJavaSearch()">æµ‹è¯•Javaç²¾ç¡®æœç´¢</button>
            <button class="btn primary" onclick="testJavaFuzzySearch()">æµ‹è¯•Javaæ¨¡ç³Šæœç´¢</button>
            <button class="btn" onclick="testFrontendAPICall()">æµ‹è¯•å‰ç«¯APIè°ƒç”¨</button>
            <div id="searchStatus"></div>
            <div id="searchResults"></div>
        </div>
    </div>

    <!-- æ­¥éª¤4: å‰ç«¯æ¨¡æ‹Ÿæµ‹è¯• -->
    <div class="container step">
        <h3>æ­¥éª¤4: å‰ç«¯é¡µé¢æ¨¡æ‹Ÿ</h3>
        <div class="step-content">
            <div style="margin-bottom: 15px;">
                <label>æ•™å¸ˆID:</label>
                <input type="text" id="teacherId" value="11111111-1111-1111-1111-111111111121" style="width: 300px; padding: 8px; margin-left: 10px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label>æŠ€æœ¯æ ‡ç­¾:</label>
                <input type="text" id="searchTag" value="Java" style="width: 200px; padding: 8px; margin-left: 10px;">
            </div>
            <button class="btn primary" onclick="simulateFrontendSearch()">æ¨¡æ‹Ÿå‰ç«¯æœç´¢</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <div id="frontendStatus"></div>
            <div id="frontendResults"></div>
        </div>
    </div>

    <script>
        // é…ç½®Supabaseå®¢æˆ·ç«¯
        const supabase = createClient(
            'https://mddpbyibesqewcktlqle.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kZHBieWliZXNxZXdja3RscWxlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MzM1NDM0OSwiZXhwIjoyMDc4OTMwMzQ5fQ.P2Y3IaRqJn6Tf7NjaHztGSd__3bTb_aBVioKoIK9Rq8'
        );

        let student2023015701 = null;
        let teacherData = null;

        // é¡µé¢åˆå§‹åŒ–
        window.onload = function() {
            initializeTest();
        };

        async function initializeTest() {
            const initStatus = document.getElementById('initStatus');
            const overallStatus = document.getElementById('overallStatus');
            
            try {
                // æµ‹è¯•æ•°æ®åº“è¿æ¥
                const { data, error } = await supabase
                    .from('users')
                    .select('count(*)')
                    .limit(1);

                if (error) {
                    throw error;
                }

                initStatus.className = 'status success';
                initStatus.innerHTML = 'âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ';
                
                // è‡ªåŠ¨æ£€æŸ¥åŸºç¡€æ•°æ®
                await checkBasicData();
                
            } catch (error) {
                initStatus.className = 'status error';
                initStatus.innerHTML = `âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ${error.message}`;
            }
        }

        async function checkBasicData() {
            const overallStatus = document.getElementById('overallStatus');
            
            try {
                // æ£€æŸ¥å­¦ç”Ÿæ¡£æ¡ˆ
                const { count: studentCount, error: studentError } = await supabase
                    .from('student_profiles')
                    .select('*', { count: 'exact', head: true });

                // æ£€æŸ¥æ•™å¸ˆæ•°æ®
                const { count: teacherCount, error: teacherError } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('role_id', '2');

                // æ£€æŸ¥æŠ€æœ¯æ ‡ç­¾
                const { count: tagCount, error: tagError } = await supabase
                    .from('student_technical_tags')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'active');

                let html = '<div class="status info">ğŸ“Š åŸºç¡€æ•°æ®çŠ¶æ€:</div>';
                html += `<ul>`;
                html += `<li>å­¦ç”Ÿæ¡£æ¡ˆ: ${studentCount || 0} ä¸ª</li>`;
                html += `<li>æ•™å¸ˆè´¦å·: ${teacherCount || 0} ä¸ª</li>`;
                html += `<li>æŠ€æœ¯æ ‡ç­¾: ${tagCount || 0} ä¸ª</li>`;
                html += `</ul>`;

                overallStatus.innerHTML = html;

            } catch (error) {
                overallStatus.innerHTML = `<div class="status error">âŒ æ£€æŸ¥åŸºç¡€æ•°æ®å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ£€æŸ¥å­¦ç”Ÿ2023015701æ•°æ®
        async function checkStudent2023015701() {
            const statusDiv = document.getElementById('studentStatus');
            statusDiv.innerHTML = '<div class="status loading">æ£€æŸ¥å­¦ç”Ÿæ•°æ®ä¸­...</div>';

            try {
                // æŸ¥æ‰¾ç”¨æˆ·
                const { data: user, error: userError } = await supabase
                    .from('users')
                    .select('id, full_name, user_number, role_id')
                    .eq('user_number', '2023015701')
                    .single();

                if (userError) {
                    throw userError;
                }

                // æŸ¥æ‰¾å­¦ç”Ÿæ¡£æ¡ˆ
                const { data: profile, error: profileError } = await supabase
                    .from('student_profiles')
                    .select('id, user_id, full_name, class_name')
                    .eq('user_id', user.id)
                    .single();

                if (profileError) {
                    throw profileError;
                }

                // æŸ¥æ‰¾æŠ€æœ¯æ ‡ç­¾
                const { data: tags, error: tagsError } = await supabase
                    .from('student_technical_tags')
                    .select('*')
                    .eq('student_profile_id', profile.id)
                    .eq('status', 'active');

                student2023015701 = {
                    user: user,
                    profile: profile,
                    tags: tags || []
                };

                let html = '<div class="status success">âœ… æ‰¾åˆ°å­¦ç”Ÿæ•°æ®:</div>';
                html += `<ul>`;
                html += `<li>å§“å: <strong>${user.full_name}</strong></li>`;
                html += `<li>å­¦å·: <strong>${user.user_number}</strong></li>`;
                html += `<li>ç”¨æˆ·ID: ${user.id}</li>`;
                html += `<li>æ¡£æ¡ˆID: ${profile.id}</li>`;
                html += `<li>ç­çº§: ${profile.class_name || 'æœªåˆ†ç­'}</li>`;
                html += `<li>æŠ€æœ¯æ ‡ç­¾æ•°é‡: ${tags?.length || 0} ä¸ª</li>`;
                `</ul>`;

                if (tags && tags.length > 0) {
                    html += '<div style="margin-top: 10px;"><strong>æŠ€æœ¯æ ‡ç­¾åˆ—è¡¨:</strong></div>';
                    tags.forEach((tag, index) => {
                        const hasJava = tag.tag_name.toLowerCase().includes('java');
                        html += `<div style="margin: 5px 0;">`;
                        html += `   ${index + 1}. <span class="${hasJava ? 'highlight' : ''}">${tag.tag_name}</span> `;
                        html += `   (${tag.tag_category}, ${tag.proficiency_level})`;
                        if (hasJava) {
                            html += ' âœ…';
                        }
                        html += `</div>`;
                    });
                } else {
                    html += '<div class="status warning">âš ï¸ è¯¥å­¦ç”Ÿæ²¡æœ‰æŠ€æœ¯æ ‡ç­¾æ•°æ®</div>';
                }

                statusDiv.innerHTML = html;

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ£€æŸ¥å­¦ç”Ÿæ•°æ®å¤±è´¥: ${error.message}</div>`;
            }
        }

        // ä¸ºå­¦ç”Ÿåˆ›å»ºJavaæ ‡ç­¾
        async function createJavaTagForStudent() {
            if (!student2023015701) {
                await checkStudent2023015701();
            }

            if (!student2023015701) {
                alert('è¯·å…ˆæ£€æŸ¥å­¦ç”Ÿæ•°æ®');
                return;
            }

            const statusDiv = document.getElementById('studentStatus');
            statusDiv.innerHTML += '<div class="status loading">åˆ›å»ºJavaæ ‡ç­¾ä¸­...</div>';

            try {
                const { data, error } = await supabase
                    .from('student_technical_tags')
                    .insert({
                        student_profile_id: student2023015701.profile.id,
                        tag_name: 'Java',
                        tag_category: 'programming_language',
                        proficiency_level: 'intermediate',
                        description: 'Javaç¼–ç¨‹è¯­è¨€å­¦ä¹ å’Œé¡¹ç›®å®è·µ',
                        learned_at: new Date().toISOString().split('T')[0],
                        learning_hours: 120,
                        practice_projects: 5,
                        confidence_score: 8,
                        status: 'active',
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    })
                    .select()
                    .single();

                if (error) {
                    throw error;
                }

                statusDiv.innerHTML += '<div class="status success">âœ… JavaæŠ€æœ¯æ ‡ç­¾åˆ›å»ºæˆåŠŸ!</div>';
                
                // é‡æ–°æ£€æŸ¥å­¦ç”Ÿæ•°æ®
                setTimeout(() => checkStudent2023015701(), 1000);

            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">âŒ åˆ›å»ºJavaæ ‡ç­¾å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ£€æŸ¥æ•™å¸ˆæ•°æ®
        async function checkTeachers() {
            const statusDiv = document.getElementById('teacherStatus');
            statusDiv.innerHTML = '<div class="status loading">æ£€æŸ¥æ•™å¸ˆæ•°æ®ä¸­...</div>';

            try {
                const { data: teachers, error: teacherError } = await supabase
                    .from('users')
                    .select('id, full_name, username')
                    .eq('role_id', '2')
                    .limit(5);

                if (teacherError) {
                    throw teacherError;
                }

                teacherData = teachers;

                let html = '<div class="status success">âœ… æ‰¾åˆ°æ•™å¸ˆæ•°æ®:</div>';
                html += '<ul>';
                teachers.forEach((teacher, index) => {
                    html += `<li>${index + 1}. <strong>${teacher.full_name}</strong> (${teacher.username})</li>`;
                    html += `   <small>ID: ${teacher.id}</small>`;
                });
                html += '</ul>';

                statusDiv.innerHTML = html;

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ£€æŸ¥æ•™å¸ˆæ•°æ®å¤±è´¥: ${error.message}</div>`;
            }
        }

        // åˆ›å»ºå¸ˆç”Ÿå…³è”
        async function createTeacherStudentRelation() {
            if (!teacherData || teacherData.length === 0) {
                await checkTeachers();
            }

            if (!teacherData || teacherData.length === 0) {
                alert('è¯·å…ˆæ£€æŸ¥æ•™å¸ˆæ•°æ®');
                return;
            }

            if (!student2023015701) {
                await checkStudent2023015701();
            }

            if (!student2023015701) {
                alert('è¯·å…ˆæ£€æŸ¥å­¦ç”Ÿæ•°æ®');
                return;
            }

            const statusDiv = document.getElementById('teacherStatus');
            const teacher = teacherData[0];

            statusDiv.innerHTML += '<div class="status loading">åˆ›å»ºå¸ˆç”Ÿå…³è”ä¸­...</div>';

            try {
                const { data, error } = await supabase
                    .from('teacher_students')
                    .insert({
                        teacher_id: teacher.id,
                        student_id: student2023015701.user.id
                    })
                    .select()
                    .single();

                if (error) {
                    throw error;
                }

                statusDiv.innerHTML += `<div class="status success">âœ… å¸ˆç”Ÿå…³è”åˆ›å»ºæˆåŠŸ: ${teacher.full_name} -> ${student2023015701.user.full_name}</div>`;

            } catch (error) {
                if (error.message.includes('duplicate')) {
                    statusDiv.innerHTML += '<div class="status info">â„¹ï¸ å¸ˆç”Ÿå…³è”å·²å­˜åœ¨</div>';
                } else {
                    statusDiv.innerHTML += `<div class="status error">âŒ åˆ›å»ºå¸ˆç”Ÿå…³è”å¤±è´¥: ${error.message}</div>`;
                }
            }
        }

        // æµ‹è¯•Javaç²¾ç¡®æœç´¢
        async function testJavaSearch() {
            const statusDiv = document.getElementById('searchStatus');
            const resultsDiv = document.getElementById('searchResults');
            
            statusDiv.innerHTML = '<div class="status loading">æ‰§è¡ŒJavaç²¾ç¡®æœç´¢...</div>';
            resultsDiv.innerHTML = '';

            try {
                const { data, error } = await supabase
                    .from('student_technical_tags')
                    .select(`
                        student_profile_id,
                        tag_name,
                        tag_category,
                        proficiency_level,
                        student_profiles!inner(
                            user_id,
                            user_number,
                            full_name,
                            class_name
                        )
                    `)
                    .eq('tag_name', 'Java')
                    .eq('status', 'active');

                if (error) {
                    throw error;
                }

                statusDiv.innerHTML = `<div class="status success">âœ… Javaç²¾ç¡®æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${data?.length || 0} ä¸ªç»“æœ</div>`;
                
                displaySearchResults(data, 'Javaç²¾ç¡®æœç´¢ç»“æœ');

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ Javaç²¾ç¡®æœç´¢å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•Javaæ¨¡ç³Šæœç´¢
        async function testJavaFuzzySearch() {
            const statusDiv = document.getElementById('searchStatus');
            const resultsDiv = document.getElementById('searchResults');
            
            statusDiv.innerHTML = '<div class="status loading">æ‰§è¡ŒJavaæ¨¡ç³Šæœç´¢...</div>';
            resultsDiv.innerHTML = '';

            try {
                const { data, error } = await supabase
                    .from('student_technical_tags')
                    .select(`
                        student_profile_id,
                        tag_name,
                        tag_category,
                        proficiency_level,
                        student_profiles!inner(
                            user_id,
                            user_number,
                            full_name,
                            class_name
                        )
                    `)
                    .ilike('tag_name', '%java%')
                    .eq('status', 'active');

                if (error) {
                    throw error;
                }

                statusDiv.innerHTML = `<div class="status success">âœ… Javaæ¨¡ç³Šæœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${data?.length || 0} ä¸ªç»“æœ</div>`;
                
                displaySearchResults(data, 'Javaæ¨¡ç³Šæœç´¢ç»“æœ');

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ Javaæ¨¡ç³Šæœç´¢å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•å‰ç«¯APIè°ƒç”¨
        async function testFrontendAPICall() {
            const statusDiv = document.getElementById('searchStatus');
            const resultsDiv = document.getElementById('searchResults');
            
            statusDiv.innerHTML = '<div class="status loading">æ¨¡æ‹Ÿå‰ç«¯APIè°ƒç”¨...</div>';
            resultsDiv.innerHTML = '';

            try {
                // ä½¿ç”¨æ¨¡æ‹Ÿçš„å‰ç«¯APIé€»è¾‘
                const teacherId = '11111111-1111-1111-1111-111111111121';
                const tagName = 'Java';

                // è·å–æ•™å¸ˆç®¡ç†çš„å­¦ç”Ÿ
                const { data: teacherStudents, error: teacherError } = await supabase
                    .from('teacher_students')
                    .select('student_id')
                    .eq('teacher_id', teacherId);

                if (teacherError) {
                    throw teacherError;
                }

                if (!teacherStudents || teacherStudents.length === 0) {
                    statusDiv.innerHTML = '<div class="status warning">âš ï¸ è¯¥æ•™å¸ˆæ²¡æœ‰ç®¡ç†ä»»ä½•å­¦ç”Ÿ</div>';
                    return;
                }

                const studentUserIds = teacherStudents.map(ts => ts.student_id);

                // æ‰§è¡Œæœç´¢
                const { data: searchResult, error: searchError } = await supabase
                    .from('student_technical_tags')
                    .select(`
                        student_profile_id,
                        tag_name,
                        tag_category,
                        proficiency_level,
                        student_profiles!inner(
                            user_id,
                            user_number,
                            full_name,
                            class_name,
                            email,
                            phone,
                            users!inner(
                                username,
                                created_at,
                                role:roles(*)
                            )
                        )
                    `)
                    .ilike('tag_name', `%${tagName.toLowerCase()}%`)
                    .eq('status', 'active')
                    .in('student_profiles.user_id', studentUserIds);

                if (searchError) {
                    throw searchError;
                }

                statusDiv.innerHTML = `<div class="status success">âœ… å‰ç«¯APIè°ƒç”¨æ¨¡æ‹ŸæˆåŠŸï¼Œæ‰¾åˆ° ${searchResult?.length || 0} ä¸ªå­¦ç”Ÿ</div>`;
                
                displaySearchResults(searchResult, 'å‰ç«¯APIè°ƒç”¨ç»“æœ');

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ å‰ç«¯APIè°ƒç”¨æ¨¡æ‹Ÿå¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ¨¡æ‹Ÿå‰ç«¯æœç´¢
        async function simulateFrontendSearch() {
            const teacherId = document.getElementById('teacherId').value;
            const searchTag = document.getElementById('searchTag').value;
            const statusDiv = document.getElementById('frontendStatus');
            const resultsDiv = document.getElementById('frontendResults');
            
            statusDiv.innerHTML = '<div class="status loading">æ¨¡æ‹Ÿå‰ç«¯æœç´¢...</div>';
            resultsDiv.innerHTML = '';

            try {
                // è·å–æ•™å¸ˆç®¡ç†çš„å­¦ç”Ÿ
                const { data: teacherStudents, error: teacherError } = await supabase
                    .from('teacher_students')
                    .select('student_id')
                    .eq('teacher_id', teacherId);

                if (teacherError) {
                    throw teacherError;
                }

                if (!teacherStudents || teacherStudents.length === 0) {
                    statusDiv.innerHTML = '<div class="status warning">âš ï¸ è¯¥æ•™å¸ˆæ²¡æœ‰ç®¡ç†ä»»ä½•å­¦ç”Ÿ</div>';
                    return;
                }

                const studentUserIds = teacherStudents.map(ts => ts.student_id);

                // æ‰§è¡Œæ¨¡ç³Šæœç´¢
                const { data: searchResult, error: searchError } = await supabase
                    .from('student_technical_tags')
                    .select(`
                        student_profile_id,
                        tag_name,
                        tag_category,
                        proficiency_level,
                        student_profiles!inner(
                            user_id,
                            user_number,
                            full_name,
                            class_name,
                            email,
                            phone
                        )
                    `)
                    .ilike('tag_name', `%${searchTag.toLowerCase()}%`)
                    .eq('status', 'active')
                    .in('student_profiles.user_id', studentUserIds);

                if (searchError) {
                    throw searchError;
                }

                statusDiv.innerHTML = `<div class="status success">âœ… æ¨¡æ‹Ÿæœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${searchResult?.length || 0} ä¸ªå­¦ç”Ÿ</div>`;
                
                if (searchResult && searchResult.length > 0) {
                    let html = '<table>';
                    html += '<thead><tr>';
                    html += '<th>å­¦å·</th><th>å§“å</th><th>ç­çº§</th><th>æŠ€æœ¯æ ‡ç­¾</th><th>åˆ†ç±»</th><th>æŒæ¡ç¨‹åº¦</th>';
                    html += '</tr></thead><tbody>';
                    
                    searchResult.forEach(item => {
                        const profile = item.student_profiles;
                        html += '<tr>';
                        html += `<td><strong>${profile.user_number}</strong></td>`;
                        html += `<td>${profile.full_name}</td>`;
                        html += `<td>${profile.class_name || 'æœªåˆ†ç­'}</td>`;
                        html += `<td><span class="tag highlight">${item.tag_name}</span></td>`;
                        html += `<td>${item.tag_category}</td>`;
                        html += `<td>${item.proficiency_level}</td>`;
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<div class="status info">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å­¦ç”Ÿ</div>';
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ æ¨¡æ‹Ÿæœç´¢å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(data, title) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (!data || data.length === 0) {
                resultsDiv.innerHTML = '<div class="status info">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</div>';
                return;
            }

            let html = `<h4>${title}:</h4>`;
            html += '<table>';
            html += '<thead><tr>';
            html += '<th>å­¦ç”Ÿå§“å</th><th>å­¦å·</th><th>ç­çº§</th><th>æŠ€æœ¯æ ‡ç­¾</th><th>åˆ†ç±»</th><th>æŒæ¡ç¨‹åº¦</th>';
            html += '</tr></thead><tbody>';
            
            data.forEach(item => {
                const profile = item.student_profiles;
                html += '<tr>';
                html += `<td><strong>${profile.full_name}</strong></td>`;
                html += `<td>${profile.user_number}</td>`;
                html += `<td>${profile.class_name || 'æœªåˆ†ç­'}</td>`;
                html += `<td><span class="tag ${item.tag_name.toLowerCase().includes('java') ? 'highlight' : ''}">${item.tag_name}</span></td>`;
                html += `<td>${item.tag_category}</td>`;
                html += `<td>${item.proficiency_level}</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            resultsDiv.innerHTML = html;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('frontendStatus').innerHTML = '';
            document.getElementById('frontendResults').innerHTML = '';
        }
    </script>
</body>
</html>