# 毕业去向批量导入功能使用指南

## 功能概述

毕业去向批量导入功能允许教师通过Excel文件快速导入多个学生的毕业去向信息，支持多种去向类型，包括就业、升学、出国、创业、待业和其他。

## 数据库表结构

### 1. graduation_destinations（毕业去向表）
主要存储学生的毕业去向信息，包括：
- 学生ID
- 去向类型（就业、升学、出国、创业、待业、其他）
- 各种去向类型的具体信息
- 审核状态和时间
- 证明材料等

### 2. graduation_import_batches（批量导入批次表）
记录每次批量导入的批次信息：
- 批次名称和文件名
- 总数、成功数、失败数
- 导入状态和错误详情

### 3. graduation_import_failures（导入失败记录表）
详细记录导入失败的原因：
- 行号和学号
- 错误信息
- 原始数据

## 前端功能

### 1. 批量导入界面
- 下载Excel模板
- 上传Excel文件
- 实时显示导入进度
- 显示最近导入记录

### 2. 导入历史管理
- 查看所有导入批次
- 显示导入统计数据
- 查看失败详情

### 3. 毕业去向列表管理
- 筛选和搜索功能
- 状态管理和审核
- 详情查看和编辑

## 使用步骤

### 第一步：数据库配置

1. 执行SQL脚本：
```sql
-- 在Supabase控制台执行 graduation_destination_management.sql
```

2. 确保RLS权限策略已正确配置

### 第二步：前端配置

1. 确保项目已安装依赖：
```bash
npm install xlsx @supabase/supabase-js
```

2. 配置环境变量：
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 第三步：使用导入功能

1. **下载模板**
   - 点击"批量导入去向"按钮
   - 点击"下载Excel模板"获取标准模板

2. **填写数据**
   - 按模板格式填写学生毕业去向信息
   - 去向类型可选值：
     - `employment` - 就业
     - `furtherstudy` - 国内升学
     - `abroad` - 出国留学
     - `entrepreneurship` - 创业
     - `unemployed` - 待业
     - `other` - 其他

3. **上传文件**
   - 选择填写好的Excel文件
   - 系统会显示文件信息

4. **执行导入**
   - 点击"导入"按钮开始处理
   - 系统显示导入进度和结果

5. **查看结果**
   - 导入完成后显示成功和失败统计
   - 可以在"导入历史"中查看详细记录

## Excel模板格式

| 列名 | 必填 | 说明 | 示例 |
|------|------|------|------|
| 学号 | 是 | 学生学号 | 2021001 |
| 去向类型 | 是 | 去向类型代码 | employment |
| 单位名称 | 否 | 就业单位名称 | 阿里巴巴（中国）有限公司 |
| 职位 | 否 | 就业职位 | 前端开发工程师 |
| 薪资 | 否 | 月薪数字 | 15000 |
| 工作地点 | 否 | 工作城市 | 杭州 |
| 学校名称 | 否 | 升学/留学学校 | 清华大学 |
| 专业 | 否 | 专业名称 | 计算机应用技术 |
| 学历层次 | 否 | 学历层次 | 硕士研究生 |
| 留学国家 | 否 | 留学国家 | 美国 |
| 创业公司名称 | 否 | 创业公司名称 | 北京创新科技有限公司 |
| 创业角色 | 否 | 创业角色 | 创始人兼CEO |
| 其他去向描述 | 否 | 其他去向描述 | 自由职业 |

## 注意事项

### 数据要求
1. **学号**必须存在于用户表中，且用户角色为student
2. **去向类型**必须使用指定的代码值
3. 每个学生只能有一条有效的毕业去向记录
4. 如果学号已存在去向记录，将会更新而不是新增

### 导入限制
1. 支持的文件格式：.xlsx, .xls
2. 单次导入建议不超过1000条记录
3. 文件大小不超过10MB

### 错误处理
1. 学号不存在：跳过该记录并记录错误
2. 格式错误：跳过该记录并记录具体错误信息
3. 数据库错误：整个导入批次标记为失败

## API接口

### 主要服务类：GraduationDestinationService

```typescript
// 获取毕业去向列表
GraduationDestinationService.getGraduationDestinations(params)

// 批量导入毕业去向
GraduationDestinationService.batchImportGraduationDestinations(
  batchName, filename, data
)

// 获取导入批次
GraduationDestinationService.getImportBatches(page, limit)

// 审核毕业去向
GraduationDestinationService.reviewGraduationDestination(
  id, status, reviewComment
)
```

## 常见问题

### Q1: 导入时提示"学号不存在"
A: 请确保学生的学号已在系统中创建，且用户角色为student。

### Q2: 导入成功但数据不显示
A: 检查数据库连接是否正常，以及RLS权限策略是否正确配置。

### Q3: Excel文件格式错误
A: 请使用系统提供的模板，确保列名和格式完全一致。

### Q4: 批量导入性能问题
A: 对于大量数据，建议分批导入，每批500-1000条记录。

## 开发调试

### 模拟模式
当Supabase未配置时，系统会自动启用模拟模式，提供基本的界面交互功能。

### 日志查看
- 浏览器控制台查看导入过程日志
- Supabase控制台查看数据库操作日志
- 检查network标签页查看API请求状态

### 错误排查
1. 检查环境变量配置
2. 验证数据库表和权限
3. 查看控制台错误信息
4. 测试API接口连通性

## 更新维护

### 版本更新
1. 备份现有数据
2. 执行新的SQL脚本
3. 更新前端代码
4. 测试功能完整性

### 数据迁移
如需从旧系统迁移数据，可使用相同的Excel模板或直接数据库导入。

---

## 联系支持

如有问题或建议，请联系开发团队或在项目issue中反馈。