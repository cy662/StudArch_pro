<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›´æ–°åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ›´æ–°åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    <p>è¿™ä¸ªé¡µé¢æµ‹è¯•æ–°çš„åŒæ­¥APIåŠŸèƒ½ï¼Œç¡®ä¿ä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®ã€‚</p>

    <div class="test-section">
        <h3>ğŸ“ æµ‹è¯•1: æŠ€æœ¯æ ‡ç­¾åŒæ­¥</h3>
        <button onclick="testSyncTags()">ç¬¬ä¸€æ¬¡åŒæ­¥ï¼ˆåº”è¯¥åˆ›å»ºï¼‰</button>
        <button onclick="testSyncTagsUpdate()">ç¬¬äºŒæ¬¡åŒæ­¥ï¼ˆåº”è¯¥è·³è¿‡å·²å­˜åœ¨ï¼‰</button>
        <div id="tagResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ æµ‹è¯•2: å­¦ä¹ æ”¶è·åŒæ­¥</h3>
        <button onclick="testSyncAchievement()">ç¬¬ä¸€æ¬¡åŒæ­¥ï¼ˆåº”è¯¥åˆ›å»ºï¼‰</button>
        <button onclick="testSyncAchievementUpdate()">ç¬¬äºŒæ¬¡åŒæ­¥ï¼ˆåº”è¯¥æ›´æ–°ï¼‰</button>
        <div id="achievementResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“ æµ‹è¯•3: å­¦ä¹ æˆæœåŒæ­¥</h3>
        <button onclick="testSyncOutcome()">ç¬¬ä¸€æ¬¡åŒæ­¥ï¼ˆåº”è¯¥åˆ›å»ºï¼‰</button>
        <button onclick="testSyncOutcomeUpdate()">ç¬¬äºŒæ¬¡åŒæ­¥ï¼ˆåº”è¯¥æ›´æ–°ï¼‰</button>
        <div id="outcomeResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ” éªŒè¯æ•°æ®çŠ¶æ€</h3>
        <button onclick="checkDataStatus()">æ£€æŸ¥æ•°æ®åº“çŠ¶æ€</button>
        <div id="statusResult" class="result"></div>
    </div>

    <script>
        const TEST_STUDENT_ID = 'f1c1aa0d-2169-4369-af14-3cadc6aa22b4';
        const TEST_COURSE = 'æ•°æ®ç»“æ„ä¸ç®—æ³•';

        async function testSyncTags() {
            showResult('tagResult', 'æ­£åœ¨æµ‹è¯•ç¬¬ä¸€æ¬¡æŠ€æœ¯æ ‡ç­¾åŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-technical-tags', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        tags: ['JavaScript', 'React', 'Node.js']
                    })
                });
                
                const result = await response.json();
                showResult('tagResult', `ç¬¬ä¸€æ¬¡åŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('tagResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testSyncTagsUpdate() {
            showResult('tagResult', 'æ­£åœ¨æµ‹è¯•ç¬¬äºŒæ¬¡æŠ€æœ¯æ ‡ç­¾åŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-technical-tags', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        tags: ['JavaScript', 'React', 'Node.js', 'TypeScript', 'Vue'] // æ·»åŠ æ–°æ ‡ç­¾
                    })
                });
                
                const result = await response.json();
                showResult('tagResult', `ç¬¬äºŒæ¬¡åŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('tagResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testSyncAchievement() {
            showResult('achievementResult', 'æ­£åœ¨æµ‹è¯•ç¬¬ä¸€æ¬¡å­¦ä¹ æ”¶è·åŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-learning-achievement', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        content: 'æŒæ¡äº†åŸºæœ¬æ•°æ®ç»“æ„ï¼Œç†è§£äº†ç®—æ³•å¤æ‚åº¦åˆ†æ'
                    })
                });
                
                const result = await response.json();
                showResult('achievementResult', `ç¬¬ä¸€æ¬¡å­¦ä¹ æ”¶è·åŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('achievementResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testSyncAchievementUpdate() {
            showResult('achievementResult', 'æ­£åœ¨æµ‹è¯•ç¬¬äºŒæ¬¡å­¦ä¹ æ”¶è·åŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-learning-achievement', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        content: 'æŒæ¡äº†åŸºæœ¬æ•°æ®ç»“æ„ï¼Œç†è§£äº†ç®—æ³•å¤æ‚åº¦åˆ†æï¼Œèƒ½å¤Ÿç‹¬ç«‹å®ç°å¸¸è§ç®—æ³•'
                    })
                });
                
                const result = await response.json();
                showResult('achievementResult', `ç¬¬äºŒæ¬¡å­¦ä¹ æ”¶è·åŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('achievementResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testSyncOutcome() {
            showResult('outcomeResult', 'æ­£åœ¨æµ‹è¯•ç¬¬ä¸€æ¬¡å­¦ä¹ æˆæœåŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-learning-outcome', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        description: 'å®Œæˆäº†æ‰€æœ‰å®éªŒé¡¹ç›®ï¼ŒæœŸä¸­æˆç»©85åˆ†',
                        start_date: '2024-02-26',
                        end_date: '2024-07-15'
                    })
                });
                
                const result = await response.json();
                showResult('outcomeResult', `ç¬¬ä¸€æ¬¡å­¦ä¹ æˆæœåŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('outcomeResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testSyncOutcomeUpdate() {
            showResult('outcomeResult', 'æ­£åœ¨æµ‹è¯•ç¬¬äºŒæ¬¡å­¦ä¹ æˆæœåŒæ­¥...', 'info');
            try {
                const response = await fetch('/api/student-learning/sync-learning-outcome', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        student_profile_id: TEST_STUDENT_ID,
                        course_name: TEST_COURSE,
                        description: 'å®Œæˆäº†æ‰€æœ‰å®éªŒé¡¹ç›®ï¼ŒæœŸä¸­æˆç»©85åˆ†ï¼ŒæœŸæœ«æˆç»©90åˆ†ï¼Œè·å¾—ä¼˜ç§€å­¦ç”Ÿç§°å·',
                        start_date: '2024-02-26',
                        end_date: '2024-07-15'
                    })
                });
                
                const result = await response.json();
                showResult('outcomeResult', `ç¬¬äºŒæ¬¡å­¦ä¹ æˆæœåŒæ­¥ç»“æœ: ${JSON.stringify(result, null, 2)}`, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('outcomeResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function checkDataStatus() {
            showResult('statusResult', 'æ­£åœ¨æ£€æŸ¥æ•°æ®åº“çŠ¶æ€...', 'info');
            try {
                const response = await fetch(`/api/student-learning/get-summary/${TEST_STUDENT_ID}`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    const courseTags = data.technical_tags.filter(tag => tag.description === `è¯¾ç¨‹: ${TEST_COURSE}`);
                    const courseAchievements = data.learning_achievements.filter(a => a.related_course === TEST_COURSE);
                    const courseOutcomes = data.learning_outcomes.filter(o => o.related_course === TEST_COURSE);
                    
                    let statusHTML = `
                        <h4>ğŸ“Š æ•°æ®çŠ¶æ€æ£€æŸ¥ç»“æœ</h4>
                        <p><strong>æ€»æŠ€æœ¯æ ‡ç­¾:</strong> ${data.technical_tags.length}</p>
                        <p><strong>æ€»å­¦ä¹ æ”¶è·:</strong> ${data.learning_achievements.length}</p>
                        <p><strong>æ€»å­¦ä¹ æˆæœ:</strong> ${data.learning_outcomes.length}</p>
                        
                        <h5>${TEST_COURSE} ç›¸å…³æ•°æ®:</h5>
                        <p><strong>æŠ€æœ¯æ ‡ç­¾è®°å½•æ•°:</strong> ${courseTags.length}</p>
                        <p><strong>å­¦ä¹ æ”¶è·è®°å½•æ•°:</strong> ${courseAchievements.length}</p>
                        <p><strong>å­¦ä¹ æˆæœè®°å½•æ•°:</strong> ${courseOutcomes.length}</p>
                    `;
                    
                    if (courseTags.length <= 5 && courseAchievements.length <= 1 && courseOutcomes.length <= 1) {
                        statusHTML += '<p class="success">âœ… æ›´æ–°åŠŸèƒ½æ­£å¸¸ï¼æ²¡æœ‰äº§ç”Ÿé‡å¤æ•°æ®ã€‚</p>';
                    } else {
                        statusHTML += '<p class="error">âŒ è­¦å‘Šï¼šå¯èƒ½å­˜åœ¨é‡å¤æ•°æ®ï¼</p>';
                    }
                    
                    showResult('statusResult', statusHTML, 'success');
                } else {
                    showResult('statusResult', `è·å–æ•°æ®å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('statusResult', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${message}</pre>`;
            element.className = `result ${type}`;
        }
    </script>
</body>
</html>