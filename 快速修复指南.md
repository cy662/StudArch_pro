# API连接问题快速修复指南

## 🔍 问题分析
从控制台错误看：
```
POST http://localhost:5173/api/student-learning/add-technical-tag 404 (Not Found)
```

**根本原因**：前端请求的是开发服务器端口5173，但API服务器运行在3001端口。

## 🚀 快速修复步骤

### 步骤1：检查API服务器状态
```bash
# 运行诊断工具
node check_api_connection.js
```

### 步骤2：启动API服务器（如果未运行）
```bash
# 在项目根目录运行
node server.js
```

应该看到输出：
```
🚀 API服务器启动成功!
📍 地址: http://localhost:3001
🔍 健康检查: http://localhost:3001/api/health
```

### 步骤3：重启前端开发服务器
```bash
# 停止当前前端服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

### 步骤4：验证修复
1. 打开浏览器开发者工具
2. 切换到Network标签
3. 在前端填写学习信息并保存
4. 检查API请求是否成功（状态码200）

## 🔧 详细排查

### 如果API服务器启动失败
检查：
1. **端口3001是否被占用**
   ```bash
   # Windows
   netstat -ano | findstr :3001
   
   # Mac/Linux  
   lsof -i :3001
   ```

2. **依赖包是否安装**
   ```bash
   npm install express cors @supabase/supabase-js
   ```

3. **环境变量配置**
   ```bash
   # 检查.env文件
   SUPABASE_URL=你的supabase地址
   SUPABASE_ANON_KEY=你的supabase密钥
   ```

### 如果前端代理不工作
检查 `vite.config.ts` 配置：
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3001',
      changeOrigin: true,
      secure: false,
      rewrite: (path) => path
    }
  }
}
```

## 🧪 测试API连接

### 手动测试
```bash
# 测试健康检查
curl http://localhost:3001/api/health

# 测试学习标签API
curl -X POST http://localhost:3001/api/student-learning/add-technical-tag \
  -H "Content-Type: application/json" \
  -d '{"student_profile_id":"test","tag_name":"test-tag"}'
```

### 浏览器测试
访问：http://localhost:3001/api/health

应该看到：
```json
{
  "success": true,
  "message": "API服务器运行正常",
  "timestamp": "2024-..."
}
```

## 📋 验证清单

修复后确认以下项目：

- [ ] API服务器在3001端口运行
- [ ] 前端开发服务器已重启
- [ ] Vite代理配置正确
- [ ] 浏览器网络请求显示200状态码
- [ ] 数据成功保存到数据库
- [ ] 刷新页面后数据仍然存在

## 🚨 常见错误

### 404 Not Found
- API服务器未启动或端口不对
- 代理配置错误
- 路由路径错误

### CORS错误  
- 没有配置CORS中间件
- 端口配置冲突

### 500 Internal Server Error
- 数据库连接问题
- API代码错误
- 环境变量配置错误

## 💡 预防措施

1. **启动脚本**：创建一个启动脚本同时启动前后端
2. **健康检查**：定期检查API服务器状态
3. **错误监控**：添加更详细的错误日志
4. **环境配置**：统一开发和生产环境配置

执行完这些步骤后，数据应该能正常保存到数据库了！