# 培养方案分配功能使用指南

## 功能概述

教师管理平台现在支持将培养方案分配给学生，分配后学生可以在自己的"教学任务与安排"页面中查看相关课程信息。

## 功能特点

✅ **教师端**：批量选择学生并分配培养方案  
✅ **学生端**：自动显示教师分配的培养方案课程  
✅ **实时同步**：分配后立即在学生端显示  
✅ **状态跟踪**：显示课程学习状态和进度  
✅ **错误处理**：完善的错误提示和反馈机制  

## 使用步骤

### 第一步：准备培养方案数据

1. **启动API服务器**
   ```bash
   node server.js
   ```

2. **导入培养方案课程**
   - 在教师端"我的学生"页面，点击"导入培养方案"按钮
   - 下载模板文件，填写课程信息
   - 上传填写好的Excel文件
   - 确认导入结果

### 第二步：分配培养方案给学生

1. **选择学生**
   - 在教师端"我的学生"页面，勾选需要分配培养方案的学生
   - 支持单选或多选

2. **选择培养方案**
   - 点击"分配培养方案"按钮
   - 在弹出的对话框中选择要分配的培养方案
   - 查看培养方案详情（专业、院系、总学分等）

3. **确认分配**
   - 点击"确认分配"按钮
   - 系统显示分配结果（成功/失败数量）
   - 分配成功后通知学生登录查看

### 第三步：学生查看培养方案

1. **学生登录系统**
   - 使用学生账号登录系统
   - 进入"教学任务与安排"页面

2. **查看培养方案**
   - 页面顶部显示培养方案名称
   - 课程列表显示所有分配的课程
   - 每门课程显示学分、学期、课程性质等信息

3. **更新学习进度**
   - 点击"编辑"按钮填写学习收获和成果
   - 上传证明材料
   - 保存学习进度

## 技术实现

### API接口

| 接口 | 方法 | 功能 |
|------|------|------|
| `/api/training-programs` | GET | 获取培养方案列表 |
| `/api/student/{studentId}/training-program-courses` | GET | 获取学生培养方案课程 |
| `/api/teacher/{teacherId}/batch-assign-training-program` | POST | 批量分配培养方案 |

### 数据库表结构

- **`training_programs`**：培养方案主表
- **`training_program_courses`**：培养方案课程表
- **`student_training_programs`**：学生-培养方案关联表
- **`student_course_progress`**：学生课程进度表

### 核心功能

1. **动态加载**：学生端页面动态加载分配的培养方案课程
2. **状态同步**：分配后立即更新学生端的显示
3. **错误处理**：完善的错误提示和降级方案
4. **权限控制**：确保教师只能给自己管理的学生分配方案

## 测试指南

### 自动化测试

1. **运行API测试脚本**
   ```bash
   node test_training_api.js
   ```

2. **执行数据库测试**
   ```bash
   psql -d your_database -f test_training_program_assignment.sql
   ```

### 手动测试

1. **教师端测试**
   - 登录教师账号
   - 导入培养方案数据
   - 选择学生并分配培养方案
   - 检查分配结果反馈

2. **学生端测试**
   - 登录学生账号
   - 查看教学任务与安排页面
   - 验证课程信息显示
   - 测试编辑和保存功能

## 故障排除

### 常见问题

**Q: 学生看不到分配的课程？**
A: 检查以下几点：
- API服务器是否正常运行
- 数据库连接是否正常
- 学生是否在教师的管理列表中
- RLS策略是否已禁用

**Q: 分配培养方案失败？**
A: 可能的原因：
- 培养方案ID不存在
- 学生不在教师管理列表中
- 数据库权限问题

**Q: 页面显示加载失败？**
A: 检查：
- 网络连接
- API服务器状态
- 数据库函数是否正确创建

### 调试方法

1. **查看浏览器控制台**：检查前端错误信息
2. **查看API日志**：检查后端错误信息
3. **数据库查询**：验证数据是否正确写入
4. **网络面板**：检查API请求是否正常

## 更新记录

### v1.0.0 (2025-11-26)
- ✅ 完成培养方案分配功能
- ✅ 实现学生端动态显示
- ✅ 添加完善的错误处理
- ✅ 创建测试脚本和文档

## 支持与反馈

如果在使用过程中遇到问题，请：
1. 查看浏览器控制台错误信息
2. 检查API服务器状态
3. 联系技术支持

---

**注意**：使用前请确保数据库已正确配置，所有必要的表和函数都已创建。